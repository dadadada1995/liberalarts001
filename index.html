<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÑ „ÇØ„É™„Çπ„Éû„ÇπËã±Ë™û„Éñ„É≠„ÉÉ„ÇØÂ¥©„Åó</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <!-- 3D„É¨„É≥„ÉÄ„É™„É≥„Ç∞ËÉåÊôØ -->
    <div id="renderer3d"></div>
    
    <canvas id="particleCanvas"></canvas>

    <div class="snowflakes" aria-hidden="true">
        <div class="snowflake">‚ùÖ</div>
        <div class="snowflake">‚ùÜ</div>
        <div class="snowflake">‚ùÖ</div>
        <div class="snowflake">‚ùÜ</div>
        <div class="snowflake">‚ùÖ</div>
        <div class="snowflake">‚ùÜ</div>
        <div class="snowflake">‚ùÖ</div>
        <div class="snowflake">‚ùÜ</div>
        <div class="snowflake">‚ùÖ</div>
        <div class="snowflake">‚ùÜ</div>
        <div class="snowflake">‚ùÖ</div>
        <div class="snowflake">‚ùÜ</div>
    </div>

    <!-- „É°„Ç§„É≥„É°„Éã„É•„ÉºÁîªÈù¢ -->
    <div id="menuScreen" class="screen active">
        <div class="menu-container">
            <div class="game-logo">
                <div class="logo-icon">üéÑ</div>
                <h1 class="logo-title">CHRISTMAS<br>BLOCK BREAKER</h1>
                <div class="logo-subtitle">English Learning Game</div>
            </div>
            
            <div class="menu-buttons">
                <button id="playButton" class="menu-btn primary-menu-btn">
                    <span class="btn-icon">üéÆ</span>
                    <span class="btn-text">PLAY GAME</span>
                </button>
                <button id="historyButton" class="menu-btn secondary-menu-btn">
                    <span class="btn-icon">üìä</span>
                    <span class="btn-text">SCORE HISTORY</span>
                </button>
                <button id="howToPlayButton" class="menu-btn secondary-menu-btn">
                    <span class="btn-icon">‚ùì</span>
                    <span class="btn-text">HOW TO PLAY</span>
                </button>
            </div>
            
            <div class="menu-footer">
                <div class="sound-toggle-menu">
                    <label class="toggle-switch">
                        <input type="checkbox" id="soundToggleMenu" checked>
                        <span class="toggle-slider"></span>
                    </label>
                    <span class="toggle-label">üîä SOUND</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ÈÅä„Å≥ÊñπÁîªÈù¢ -->
    <div id="howToPlayScreen" class="screen">
        <div class="container how-to-container">
            <h2 class="section-title">HOW TO PLAY</h2>
            
            <div class="how-to-content">
                <div class="how-to-item">
                    <div class="how-to-icon">üéØ</div>
                    <h3>„Ç≤„Éº„É†„ÅÆÁõÆÁöÑ</h3>
                    <p>„Éñ„É≠„ÉÉ„ÇØ„ÇíÂ£ä„Åó„Å¶„Ç¢„É´„Éï„Ç°„Éô„ÉÉ„Éà„ÇíÈõÜ„ÇÅ„ÄÅËã±ÂçòË™û„Çí‰Ωú„Å£„Å¶„Çπ„Ç≥„Ç¢„ÇíÁ®º„Åî„ÅÜÔºÅ</p>
                </div>
                
                <div class="how-to-item">
                    <div class="how-to-icon">‚≠ê</div>
                    <h3>„Çπ„Ç≥„Ç¢„Ç∑„Çπ„ÉÜ„É†</h3>
                    <p>„Éñ„É≠„ÉÉ„ÇØÁ†¥Â£ä: +10ÁÇπ<br>3ÊñáÂ≠óÂçòË™û: +100ÁÇπ<br>4ÊñáÂ≠óÂçòË™û: +200ÁÇπ<br>5ÊñáÂ≠óÂçòË™û: +400ÁÇπ<br>6ÊñáÂ≠ó‰ª•‰∏ä: +800ÁÇπ„Äú</p>
                </div>
                
                <div class="how-to-item">
                    <div class="how-to-icon">üî•</div>
                    <h3>„Ç≥„É≥„Éú„Ç∑„Çπ„ÉÜ„É†</h3>
                    <p>ÈÄ£Á∂ö„Åß„Éñ„É≠„ÉÉ„ÇØ„ÇíÂ£ä„Åô„Å®„Ç≥„É≥„ÉúÁô∫ÁîüÔºÅ<br>„Ç≥„É≥„ÉúÊï∞ √ó 50ÁÇπ„ÅÆ„Éú„Éº„Éä„Çπ</p>
                </div>
                
                <div class="how-to-item">
                    <div class="how-to-icon">‚ö†Ô∏è</div>
                    <h3>Ê≥®ÊÑè‰∫ãÈ†Ö</h3>
                    <p>Âà∂ÈôêÊôÇÈñì„ÅØ60Áßí<br>„Éú„Éº„É´„ÅØ3ÂÄã„Åæ„Åß<br>„Çµ„É≥„Çø„Éñ„É≠„ÉÉ„ÇØ„ÇíÂ£ä„Åô„Å®+5000ÁÇπÔºÅ</p>
                </div>
            </div>
            
            <button id="backToMenuFromHow" class="menu-btn primary-menu-btn">
                <span class="btn-text">BACK TO MENU</span>
            </button>
        </div>
    </div>

    <!-- „Çπ„Ç≥„Ç¢Â±•Ê≠¥ÁîªÈù¢ -->
    <div id="historyScreen" class="screen">
        <div class="container history-container">
            <h2 class="section-title">üìä SCORE HISTORY üìä</h2>
            
            <!-- Áµ±Ë®àÊÉÖÂ†± -->
            <div id="statisticsContainer" class="statistics-section"></div>
            
            <div class="difficulty-tabs">
                <button class="tab-btn active" data-difficulty="all">
                    <span>ALL</span>
                </button>
                <button class="tab-btn" data-difficulty="easy">
                    <span>‚≠ê EASY</span>
                </button>
                <button class="tab-btn" data-difficulty="normal">
                    <span>‚≠ê‚≠ê NORMAL</span>
                </button>
                <button class="tab-btn" data-difficulty="hard">
                    <span>‚≠ê‚≠ê‚≠ê HARD</span>
                </button>
            </div>
            
            <div class="history-table-container">
                <table class="history-table">
                    <thead>
                        <tr>
                            <th style="width: 60px;">È†Ü‰Ωç</th>
                            <th>„Éó„É¨„Ç§„É§„Éº</th>
                            <th style="width: 120px;">„Çπ„Ç≥„Ç¢</th>
                            <th style="width: 100px;">Èõ£ÊòìÂ∫¶</th>
                            <th style="width: 140px;">Êó•ÊôÇ</th>
                            <th style="width: 80px;">Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody id="historyTableBody">
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                Loading...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <div class="history-info">
                <p style="font-size: 14px; color: var(--text-dim); margin: 10px 0;">
                    üí° „ÅÇ„Å™„Åü„ÅÆÈÅéÂéª„ÅÆ„Éó„É¨„Ç§Ë®òÈå≤„ÅåË°®Á§∫„Åï„Çå„Åæ„ÅôÔºàÊúÄÂ§ß50‰ª∂Ôºâ
                </p>
            </div>
            
            <div class="history-actions">
                <button id="clearHistoryButton" class="menu-btn danger-btn">
                    <span class="btn-text">CLEAR HISTORY</span>
                </button>
                <button id="backToMenuFromHistory" class="menu-btn primary-menu-btn">
                    <span class="btn-text">BACK TO MENU</span>
                </button>
            </div>
        </div>
    </div>

    <!-- „É≠„Ç∞„Ç§„É≥ÁîªÈù¢ -->
    <div id="loginScreen" class="screen">
        <div class="container game-setup-container">
            <h2 class="section-title">GAME SETUP</h2>
            
            <div class="setup-section">
                <label class="setup-label">PLAYER NAME</label>
                <input type="text" id="nicknameInput" class="game-input" placeholder="Enter your name" maxlength="15">
            </div>
            
            <div class="setup-section">
                <label class="setup-label">DIFFICULTY</label>
                <div class="difficulty-selector">
                    <button class="difficulty-card active" data-difficulty="easy">
                        <div class="card-icon">‚≠ê</div>
                        <div class="card-title">EASY</div>
                        <div class="card-desc">Ball Speed: Slow<br>Paddle: Large</div>
                    </button>
                    <button class="difficulty-card" data-difficulty="normal">
                        <div class="card-icon">‚≠ê‚≠ê</div>
                        <div class="card-title">NORMAL</div>
                        <div class="card-desc">Ball Speed: Medium<br>Paddle: Medium</div>
                    </button>
                    <button class="difficulty-card" data-difficulty="hard">
                        <div class="card-icon">‚≠ê‚≠ê‚≠ê</div>
                        <div class="card-title">HARD</div>
                        <div class="card-desc">Ball Speed: Fast<br>Paddle: Small</div>
                    </button>
                </div>
            </div>
            
            <div class="setup-actions">
                <button id="startButton" class="menu-btn primary-menu-btn">
                    <span class="btn-icon">üéÆ</span>
                    <span class="btn-text">START GAME</span>
                </button>
                <button id="backToMenuFromSetup" class="menu-btn secondary-menu-btn">
                    <span class="btn-text">BACK</span>
                </button>
            </div>
        </div>
    </div>

    <!-- „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥ÁîªÈù¢ -->
    <div id="countdownScreen" class="screen">
        <div class="countdown-container">
            <div class="countdown-circle">
                <span id="countdownNumber" class="countdown-text">3</span>
            </div>
        </div>
    </div>

    <!-- „Ç≤„Éº„É†ÁîªÈù¢ -->
    <div id="gameScreen" class="screen">
        <div class="game-header">
            <div class="header-left">
                <div class="stat-box">
                    <div class="stat-icon">‚è∞</div>
                    <div class="stat-content">
                        <div class="stat-label">TIME</div>
                        <div id="timer" class="stat-value">60</div>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon">üéà</div>
                    <div class="stat-content">
                        <div class="stat-label">BALL</div>
                        <div id="ballCount" class="stat-value">3</div>
                    </div>
                </div>
            </div>
            
            <div class="header-center">
                <div class="score-display">
                    <div class="score-label">SCORE</div>
                    <div id="score" class="score-value">0</div>
                </div>
            </div>
            
            <div class="header-right">
                <div class="stat-box">
                    <div class="stat-icon">üî•</div>
                    <div class="stat-content">
                        <div class="stat-label">COMBO</div>
                        <div id="combo" class="stat-value combo-value">0</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="game-canvas-wrapper">
            <canvas id="gameCanvas"></canvas>
            <div class="progress-bar-container">
                <div id="progressBar" class="progress-bar"></div>
            </div>
        </div>

        <div class="word-panel">
            <div class="panel-header">
                <span class="panel-title">COLLECTED LETTERS</span>
            </div>
            <div id="collectedLetters" class="letters-grid"></div>
        </div>
    </div>

    <!-- Ëã±ÂçòË™û‰ΩúÊàêÁîªÈù¢ -->
    <div id="wordMakeScreen" class="screen">
        <div class="container word-make-container">
            <h2 class="section-title">üìù WORD MAKING PHASE</h2>
            
            <div class="word-make-header">
                <div class="stat-box">
                    <div class="stat-icon">‚è∞</div>
                    <div class="stat-content">
                        <div class="stat-label">TIME</div>
                        <div id="wordMakeTimer" class="stat-value">30</div>
                    </div>
                </div>
                <div class="stat-box">
                    <div class="stat-icon">‚≠ê</div>
                    <div class="stat-content">
                        <div class="stat-label">SCORE</div>
                        <div id="wordMakeScore" class="stat-value">0</div>
                    </div>
                </div>
            </div>
            
            <div class="word-make-info">
                <p>ÂèéÈõÜ„Åó„ÅüÊñáÂ≠ó„Çí‰Ωø„Å£„Å¶Ëã±ÂçòË™û„Çí‰ΩúÊàê„Åó„Åæ„Åó„Çá„ÅÜÔºÅ</p>
            </div>
            
            <div class="word-section">
                <label class="section-label">ÁèæÂú®„ÅÆÂçòË™û</label>
                <div id="currentWordDisplay" class="word-display">
                    <span class="empty-message">ÊñáÂ≠ó„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Å¶ÂçòË™û„Çí‰ΩúÊàê</span>
                </div>
            </div>
            
            <div class="word-controls">
                <button id="submitWordBtn" class="word-btn primary-word-btn">
                    <span class="btn-icon">‚úì</span>
                    <span class="btn-text">ÈÄÅ‰ø°</span>
                </button>
                <button id="clearWordBtn" class="word-btn secondary-word-btn">
                    <span class="btn-icon">‚úó</span>
                    <span class="btn-text">„ÇØ„É™„Ç¢</span>
                </button>
            </div>
            
            <div id="wordMakeMessage" class="word-make-message"></div>
            
            <div class="word-section">
                <label class="section-label">Âà©Áî®ÂèØËÉΩ„Å™ÊñáÂ≠ó</label>
                <div id="availableLettersDisplay" class="letters-display"></div>
            </div>
            
            <div class="word-section">
                <label class="section-label">‰ΩúÊàê„Åó„ÅüÂçòË™û</label>
                <div id="createdWordsList" class="created-words-list">
                    <span class="empty-message">„Åæ„Å†ÂçòË™û„Çí‰ΩúÊàê„Åó„Å¶„ÅÑ„Åæ„Åõ„Çì</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ÁµêÊûúÁîªÈù¢ -->
    <div id="resultScreen" class="screen">
        <div class="container result-container">
            <div class="result-rank" id="rankDisplay">
                <div class="rank-badge">
                    <div class="rank-icon">üèÜ</div>
                    <div class="rank-text">RANK S</div>
                </div>
            </div>
            
            <h2 class="section-title">GAME OVER</h2>
            
            <div class="result-stats">
                <div class="result-stat-item">
                    <div class="result-stat-label">PLAYER</div>
                    <div id="resultName" class="result-stat-value">---</div>
                </div>
                <div class="result-stat-item highlight">
                    <div class="result-stat-label">FINAL SCORE</div>
                    <div id="finalScore" class="result-stat-value score-highlight">0</div>
                </div>
                <div class="result-stat-item">
                    <div class="result-stat-label">BLOCK BREAK SCORE</div>
                    <div id="blockBreakScoreDisplay" class="result-stat-value">0</div>
                </div>
                <div class="result-stat-item">
                    <div class="result-stat-label">WORD MAKE SCORE</div>
                    <div id="wordMakeScoreDisplay" class="result-stat-value">0</div>
                </div>
                <div class="result-stat-item">
                    <div class="result-stat-label">WORDS CREATED</div>
                    <div id="wordCount" class="result-stat-value">0</div>
                </div>
                <div class="result-stat-item">
                    <div class="result-stat-label">MAX COMBO</div>
                    <div id="maxCombo" class="result-stat-value">0</div>
                </div>
                <div class="result-stat-item">
                    <div class="result-stat-label">BLOCKS DESTROYED</div>
                    <div id="totalBlocks" class="result-stat-value">0</div>
                </div>
            </div>
            
            <div id="resultCreatedWords" class="words-created-section"></div>
            
            <div class="result-actions">
                <button id="playAgain" class="menu-btn primary-menu-btn">
                    <span class="btn-icon">üîÑ</span>
                    <span class="btn-text">PLAY AGAIN</span>
                </button>
                <button id="viewHistory" class="menu-btn secondary-menu-btn">
                    <span class="btn-icon">üìä</span>
                    <span class="btn-text">VIEW HISTORY</span>
                </button>
                <button id="backToMenuFromResult" class="menu-btn secondary-menu-btn">
                    <span class="btn-text">MAIN MENU</span>
                </button>
            </div>
        </div>
    </div>

    <div id="merryChristmasPopup" class="merry-christmas-popup">
        <div class="popup-content">
            <div class="popup-icon">üéÖüéÑ</div>
            <h2 class="popup-title">Merry Christmas!</h2>
            <p class="popup-bonus">+5000 BONUS!</p>
        </div>
    </div>

    <!-- „Çπ„ÇØ„É™„Éó„ÉàË™≠„ÅøËæº„ÅøÔºàÈ†ÜÂ∫è„ÅåÈáçË¶ÅÔºÅÔºâ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.19.0/matter.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <!-- 1. ÊúÄÂàù„Å´Ë®≠ÂÆö„Éï„Ç°„Ç§„É´ -->
    <script src="js/config.js"></script>
    
    <!-- 2. „É¶„Éº„ÉÜ„Ç£„É™„ÉÜ„Ç£„ÇØ„É©„Çπ -->
    <script src="js/sound.js"></script>
    <script src="js/particles.js"></script>
    <script src="js/renderer3d.js"></script>
    
    <!-- 3. „É©„É≥„Ç≠„É≥„Ç∞„Å®UI -->
    <script src="js/ranking.js"></script>
    <script src="js/ui.js"></script>
    
    <!-- 4. Áâ©ÁêÜ„Ç®„É≥„Ç∏„É≥ -->
    <script src="js/physics.js"></script>
    
    <!-- 5. ÊúÄÂæå„Å´„É°„Ç§„É≥„Ç≤„Éº„É†„ÇØ„É©„Çπ -->
    <script src="js/game.js"></script>

    <!-- ÂàùÊúüÂåñ„Çπ„ÇØ„É™„Éó„Éà -->
    <script>
        console.log('üéÑ Christmas Block Breaker - Initializing...');

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initGame);
        } else {
            initGame();
        }

        function initGame() {
            console.log('‚úÖ DOM Ready - Starting initialization');
            
            setTimeout(() => {
                try {
                    if (typeof CONFIG === 'undefined') {
                        console.error('‚ùå CONFIG is not defined! Check config.js loading.');
                        alert('Ë®≠ÂÆö„Éï„Ç°„Ç§„É´„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„ÇíÂÜçË™≠„ÅøËæº„Åø„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
                        return;
                    }
                    
                    console.log('‚úÖ CONFIG loaded successfully');
                    
                    // 3D„É¨„É≥„ÉÄ„É©„Éº„ÅÆÂàùÊúüÂåñ
                    if (typeof THREE !== 'undefined') {
                        window.renderer3d = new Renderer3D();
                        console.log('‚úÖ 3D Renderer initialized');
                    } else {
                        console.warn('‚ö†Ô∏è Three.js not loaded, 3D effects disabled');
                    }
                    
                    if (window.game) {
                        console.log('üóëÔ∏è Removing old game instance');
                        delete window.game;
                    }
                    
                    window.game = new Game();
                    console.log('‚úÖ Game initialized successfully');
                    
                    console.log('üìä Initialization complete:', {
                        hasGame: !!window.game,
                        hasUI: !!window.game?.ui,
                        has3DRenderer: !!window.renderer3d,
                        hasStartButton: !!document.getElementById('startButton'),
                        hasNicknameInput: !!document.getElementById('nicknameInput'),
                        hasCONFIG: typeof CONFIG !== 'undefined'
                    });
                    
                } catch (error) {
                    console.error('‚ùå Initialization error:', error);
                    console.error('Stack trace:', error.stack);
                    alert('„Ç≤„Éº„É†„ÅÆÂàùÊúüÂåñ„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message);
                }
            }, 100);
        }
    </script>
</body>
</html>
